import cv2
import numpy as np

# Fotoğrafı oku
image = cv2.imread('Foto.jfif')

# Gri seviyeye dönüştür
gray = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)

# Eşikleme uygula
_, thresh = cv2.threshold(gray, 150, 255, cv2.THRESH_BINARY)

# Morfolojik işlemler uygula
kernel = np.ones((5, 5), np.uint8)
morph = cv2.morphologyEx(thresh, cv2.MORPH_CLOSE, kernel, iterations=2)

# Etiketleme yap
retval, labels, stats, centroids = cv2.connectedComponentsWithStats(morph)

# Pirinç sayısı
rice_count = retval - 1  # Arka planı saymama

# Görüntüyü çiz
for i in range(1, retval):
    x, y, w, h, area = stats[i]
    cv2.rectangle(image, (x, y), (x + w, y + h), (0, 255, 0), 2)

# Sonuçları ekrana yazdır
print("Pirinç Sayısı:", rice_count)

# Görüntüleri göster
cv2.imshow('Original Image', image)
cv2.imshow('Threshold Image', thresh)
cv2.imshow('Morphological Image', morph)
cv2.waitKey(0)
cv2.destroyAllWindows()
